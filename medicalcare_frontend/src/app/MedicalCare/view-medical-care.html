<div class="container mt-3">
    <div class="row mt-3">
        <div class="card">
            <div class="card-header">
                <form [formGroup]="form">
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Patient</label>
                        <div class="col-sm-8">
                            <select class="form-select" formControlName="patient_id">
                                @for (item of data | async; track $index) {
                                    <option [ngValue] ="item.patient_id">
                                        {{item.patient_code}}
                                    </option>                            
                                }
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Month of visit date</label>
                        <div class="col-sm-8">
                            <select class="form-select" formControlName="visit_month">
                                @for (month of months; track $index) {
                                    <option [ngValue] ="month">
                                        {{pad(month)}}
                                    </option>                            
                                }
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Year of visit date</label>
                        <div class="col-sm-8">
                            <select class="form-select" formControlName="visit_year">
                                <option [ngValue]="0" selected></option>
                                @for (year of years; track $index) {
                                    <option [ngValue]="year">
                                        {{year}}
                                    </option>                            
                                }
                            </select>
                        </div>
                    </div>
                    <div>
                        <input type="hidden" formControlName="DataLoaded">
                    </div>
                </form>
                    <div class="input-group mb-3">
                        <button class="btn btn-outline-success my-2 my-sm-0" type="button" (click)="onSearch('Medicalcare')">Search Medicalcare</button>
                        <button class="btn btn-outline-success my-2 my-sm-0" type="button" (click)="onSearch('Billing')">Search Billing</button>
                    </div>
                    @if(searchMedical || searchBilling){
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="tableFixHead">
                                    <div class="container">
                                        <h2>Hồ sơ bệnh án</h2>
                                        <div id="MedicalReports">
                                            <table class="my-double-bordered-table">
                                                <tr>
                                                    <td>Số thứ tự</td>
                                                    <td class="borderleft" colspan="3">{{patientItem?.patient_code??""}}</td>
                                                    <td>&nbsp;</td>
                                                    <td class="alnrleft borderleft-double">Số bảo hiểm</td>
                                                    <td class="alncenter borderleft">{{patientItem?.insurance_policy_number??""}}</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="5" class=" bordertop">&nbsp;</td>
                                                    <td class="alnrleft borderleft-double bordertop">Hạn sử dụng bảo hiểm</td>
                                                    <td class="alncenter borderleft bordertop">{{formatDateToString(patientItem?.insurance_expire??today, 'dd/MM/yyyy')}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td rowspan="4" class="bordertop-double">Người bệnh</td>
                                                    <td class="borderleft bordertop-double">Họ Tên</td>
                                                    <td class="borderleft bordertop-double">{{patientItem?.patient_name??""}}
                                                    </td>
                                                    <td colspan="2" class="bordertop-double">&nbsp;</td>
                                                    <td class="alnrleft borderleft-double bordertop">Tên người có bảo hiểm</td>
                                                    <td class="alncenter borderleft bordertop">{{patientItem?.patient_name??""}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="borderleft bordertop">Ngày sinh</td>
                                                    <td class="borderleft bordertop">{{formatDateToString(patientItem?.date_of_birth??today, 'dd/MM/yyyy')}}
                                                    </td>
                                                    <td class="borderleft bordertop">Giới tính</td>
                                                    <td class="borderleft bordertop">{{patientItem?.gender??""}}
                                                    </td>
                                                    <td rowspan="2" class="alnrleft borderleft-double bordertop">Địa chỉ</td>
                                                    <td rowspan="2" class="alncenter borderleft bordertop">{{patientItem?.home_address??""}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="borderleft bordertop">Địa chỉ</td>
                                                    <td class="borderleft bordertop">{{patientItem?.home_address??""}}
                                                    </td>
                                                    <td class="bordertop" colspan="2">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td class="borderleft bordertop">Công việc</td>
                                                    <td class="borderleft bordertop">{{patientItem?.job??""}}
                                                    </td>
                                                    <td class="borderleft bordertop">Dạng bảo hiểm</td>
                                                    <td class="borderleft bordertop">{{patientItem?.insurance_type??""}}
                                                    </td>
                                                    <td class="alnrleft borderleft-double bordertop">Địa chỉ công ty</td>
                                                    <td class="alncenter borderleft bordertop">{{patientItem?.office_address??""}}
                                                    </td>
                                                </tr>
                                                <tr class="borderleft bordertop-double">
                                                    <td class="alncenter" colspan="4">Tên bệnh</td>
                                                    <td class="alncenter borderleft">Bắt đầu</td>
                                                    <td class="alncenter borderleft">Kết thúc</td>
                                                    <td class="alncenter borderleft">Chuyển bệnh</td>
                                                </tr>
                                                @for (item of this.medicalCares; track $index) {
                                                    <tr class="borderleft bordertop">
                                                        <td class="alncenter" colspan="4">{{item.diagnostic}}</td>
                                                        <td class="alncenter borderleft">
                                                            @if(item.start_date != null) {
                                                                {{formatDateToString(item.start_date, "dd/MM/yyyy")}}
                                                            }
                                                        </td>
                                                        <td class="alncenter borderleft">
                                                            @if(item.end_date != null) {
                                                                {{formatDateToString(item.end_date, "dd/MM/yyyy")}}
                                                            }
                                                        </td>
                                                        <td class="alncenter borderleft"></td>
                                                    </tr>
                                                }
                                                <tr class="borderleft bordertop-double borderbottom">
                                                    <td class="alncenter" colspan="4">Lịch sử bệnh - Quá trình chữa bệnh</td>
                                                    <td class="alncenter borderleft" colspan="3">Đơn thuốc - Phẫu thuật - Trị liệu</td>
                                                </tr>
                                                @for (item of medicalCares; track $index){
                                                    <tr>
                                                        <td class="borderright alncenter" colspan="4">
                                                            <table class="table">
                                                            @for (treatmentItem of item.treatments; track $index) {
                                                                <tr>
                                                                    <td class="fw-bold">{{formatDateToString(treatmentItem.treatment_date, 'dd/MM/yyyy')}}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>{{treatmentItem.treatment_type}}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>{{treatmentItem.description}}</td>
                                                                </tr>
                                                            }
                                                            </table>
                                                        </td>
                                                        <td colspan="3">
                                                            <table class="table">
                                                                <tr>
                                                                    <td colspan="2" class="ps-3">Đơn thuốc</td>
                                                                </tr>
                                                            @for (prescriptionItem of item.prescriptions; track $index) {
                                                                <tr>
                                                                    <td class="ps-5">{{prescriptionItem.medicine_name}}</td>
                                                                    <td>{{prescriptionItem.quantity}} {{prescriptionItem.medicine}}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="2" class="ps-5">{{prescriptionItem.dosage}}</td>
                                                                </tr>
                                                            }
                                                            </table>
                                                        </td>
                                                    </tr>
                                                }
                                            </table>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="form-group">
                                                <button class="btn btn-outline-success my-2 my-sm-0" type="button" (click)="onPrint()">Print</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    @if(searchBilling) {
                        <table class="table">
                            <thead class="table-header">
                            <tr>
                                <th>#</th>
                                <th>Prescription Date</th>
                                <th>Medicine</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Amount</th>
                            </tr>
                            </thead>
                        </table>
                    }
            </div>
        </div>
    </div>
</div>
<router-outlet></router-outlet>
